@model IEnumerable<MinecraftBackend.Models.ShopItem>

@{
    ViewData["Title"] = "Shop Items";
}

<div class="glass-card">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-white mb-0"><i class="fas fa-box-open text-info me-2"></i>Shop Management</h2>
            <p class="text-white-50 small mb-0">Manage game items, pricing, and visibility.</p>
        </div>
        <a asp-action="CreateItem" class="btn btn-info text-white rounded-pill px-4 shadow-lg fw-bold">
            <i class="fas fa-plus me-2"></i> Add New Item
        </a>
    </div>

    <form method="get" class="input-group mb-4 shadow-sm">
        <span class="input-group-text bg-black border-secondary text-info"><i class="fas fa-search"></i></span>
        <input type="text" name="search" class="form-control bg-dark text-white border-secondary" placeholder="Search by Name or ID..." value="@ViewBag.CurrentSearch">
        <button class="btn btn-outline-info">Search</button>
    </form>

    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0 text-white">
            <thead class="bg-white bg-opacity-10 text-uppercase text-info small border-bottom border-info">
                <tr>
                    <th class="ps-4" style="width: 30%;">
                        <a asp-action="Items" asp-route-sortOrder="@ViewBag.NameSortParm" asp-route-search="@ViewBag.CurrentSearch" class="text-decoration-none text-info">
                            Item Detail <i class="fas fa-sort ms-1"></i>
                        </a>
                    </th>
                    
                    <th>
                        <a asp-action="Items" asp-route-sortOrder="@ViewBag.TypeSortParm" asp-route-search="@ViewBag.CurrentSearch" class="text-decoration-none text-info">
                            Type <i class="fas fa-sort ms-1"></i>
                        </a>
                    </th>
                    
                    <th>
                        <a asp-action="Items" asp-route-sortOrder="@ViewBag.PriceSortParm" asp-route-search="@ViewBag.CurrentSearch" class="text-decoration-none text-info">
                            Price <i class="fas fa-sort ms-1"></i>
                        </a>
                    </th>
                    
                    <th>
                        <a asp-action="Items" asp-route-sortOrder="@ViewBag.StatusSortParm" asp-route-search="@ViewBag.CurrentSearch" class="text-decoration-none text-info">
                            Status <i class="fas fa-sort ms-1"></i>
                        </a>
                    </th>
                    
                    <th class="text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        <tr>
                            <td class="ps-4">
                                <div class="d-flex align-items-center">
                                    <div class="position-relative me-3">
                                        <img src="@(item.ImageURL ?? "/images/others/default.png")" 
                                             class="rounded-3 border border-secondary shadow-sm" 
                                             width="50" height="50" 
                                             style="object-fit: contain; background-color: rgba(0,0,0,0.3);"
                                             onerror="this.src='/images/others/default.png'">
                                    </div>
                                    <div>
                                        <div class="fw-bold text-black">@item.Name</div>
                                        <small class="text-black-50 text-truncate d-block" style="max-width: 200px;">@item.Description</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="font-monospace text-warning small mb-1">@item.ProductID</div>
                                <span class="badge rounded-pill border border-info text-info bg-info bg-opacity-10">@item.ItemType</span>
                                
                                @{
                                    string badgeClass = item.Rarity?.ToLower() switch {
                                        "common" => "bg-secondary",
                                        "rare" => "bg-primary",
                                        "epic" => "bg-info text-dark",
                                        "legendary" => "bg-warning text-dark",
                                        _ => "bg-secondary"
                                    };
                                }
                                <span class="badge @badgeClass bg-opacity-75 ms-1">@item.Rarity</span>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    @if(item.PriceCurrency == "RES_GOLD")
                                    {
                                        <i class="fas fa-coins text-warning me-2"></i> <span class="text-warning fw-bold">@item.PriceAmount G</span>
                                    }
                                    else
                                    {
                                        <i class="far fa-gem text-info me-2"></i> <span class="text-info fw-bold">@item.PriceAmount Gem</span>
                                    }
                                </div>
                            </td>
                            <td>
                                @if (item.IsShow)
                                {
                                    <span class="badge bg-success bg-opacity-75"><i class="fas fa-eye me-1"></i> On Sale</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary bg-opacity-50"><i class="fas fa-eye-slash me-1"></i> Hidden</span>
                                }
                            </td>
                            <td class="text-end pe-4">
                                <div class="btn-group">
                                    <a asp-action="EditItem" asp-route-id="@item.ProductID" class="btn btn-sm btn-outline-warning" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a asp-action="DeleteItem" asp-route-id="@item.ProductID" class="btn btn-sm btn-outline-danger" title="Delete" onclick="return confirm('Delete this item?');">
                                        <i class="fas fa-trash-alt"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="5" class="text-center py-5 text-white-50">
                            <i class="fas fa-box-open fa-3x mb-3 opacity-25"></i>
                            <p>No items found.</p>
                            <form asp-action="SeedDataStrict" method="post">
                                <button type="submit" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-magic me-2"></i> Initialize Sample Data
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @if (ViewBag.TotalPages > 1)
    {
        <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top border-secondary">
            <div class="text-white-50 small">
                Showing page <span class="text-info fw-bold">@ViewBag.CurrentPage</span> of @ViewBag.TotalPages
            </div>

            <div class="btn-group shadow-sm">
                <a asp-action="Items" 
                   asp-route-page="@(ViewBag.CurrentPage - 1)" 
                   asp-route-search="@ViewBag.CurrentSearch"
                   asp-route-sortOrder="@ViewBag.CurrentSort"
                   class="btn btn-outline-secondary btn-sm @(ViewBag.CurrentPage <= 1 ? "disabled" : "")">
                    <i class="fas fa-chevron-left me-1"></i> Prev
                </a>

                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    if (ViewBag.TotalPages <= 10 || (i >= ViewBag.CurrentPage - 2 && i <= ViewBag.CurrentPage + 2) || i == 1 || i == ViewBag.TotalPages)
                    {
                        <a asp-action="Items" 
                           asp-route-page="@i" 
                           asp-route-search="@ViewBag.CurrentSearch"
                           asp-route-sortOrder="@ViewBag.CurrentSort" 
                           class="btn btn-sm @(i == ViewBag.CurrentPage ? "btn-info fw-bold" : "btn-outline-secondary text-white-50")">
                           @i
                        </a>
                    }
                    else if (i == ViewBag.CurrentPage - 3 || i == ViewBag.CurrentPage + 3)
                    {
                        <span class="btn btn-sm btn-outline-secondary disabled border-0">...</span>
                    }
                }

                <a asp-action="Items" 
                   asp-route-page="@(ViewBag.CurrentPage + 1)" 
                   asp-route-search="@ViewBag.CurrentSearch"
                   asp-route-sortOrder="@ViewBag.CurrentSort" 
                   class="btn btn-outline-secondary btn-sm @(ViewBag.CurrentPage >= ViewBag.TotalPages ? "disabled" : "")">
                    Next <i class="fas fa-chevron-right ms-1"></i>
                </a>
            </div>
        </div>
    }
</div>