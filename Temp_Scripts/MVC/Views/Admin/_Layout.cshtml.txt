<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Minecraft Admin</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    
    <link href="/css/site.css" rel="stylesheet">
</head>
<body>
    <audio id="bgm" loop>
        <source src="/audio/bgm.mp3" type="audio/mpeg">
    </audio>
    <audio id="sfx">
        <source src="/audio/click.mp3" type="audio/mpeg">
    </audio>

    <div id="page-loader" style="position: fixed; top: 0; left: 0; height: 3px; background: #00d2ff; width: 0%; z-index: 9999; transition: width 0.2s, opacity 0.4s; box-shadow: 0 0 10px #00d2ff;"></div>

    <div class="sidebar d-flex flex-column p-3">
        <div class="mb-4 text-center">
            <h3 class="text-info fw-bold animate__animated animate__fadeInDown" style="letter-spacing: 2px;">
                <i class="fas fa-cube me-2"></i>MC ADMIN
            </h3>
            <div class="badge bg-success bg-opacity-25 text-success border border-success">v1.0.0 Stable</div>
        </div>

        <button onclick="toggleMusic()" class="btn btn-sm btn-outline-info w-100 mb-4 shadow-sm glass-hover">
            <i id="musicIcon" class="fas fa-play me-2"></i>Music: OFF
        </button>

        <nav class="nav flex-column gap-2">
            <div class="text-white-50 small fw-bold text-uppercase mb-2 ms-2">Core</div>
            <a href="/Admin/Dashboard" class="nav-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Dashboard" ? "active" : "")">
                <i class="fas fa-chart-line me-2"></i> Dashboard
            </a>
            <a href="/Admin/Users" class="nav-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Users" || ViewContext.RouteData.Values["Action"]?.ToString() == "UserDetails" ? "active" : "")">
                <i class="fas fa-users me-2"></i> Players
            </a>
            
            <div class="text-white-50 small fw-bold text-uppercase mt-3 mb-2 ms-2">Game Data</div>
            <a href="/Admin/Items" class="nav-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Items" ? "active" : "")">
                <i class="fas fa-box-open me-2"></i> Inventory
            </a>
            <a href="/Admin/Logs" class="nav-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Logs" ? "active" : "")">
                <i class="fas fa-history me-2"></i> System Logs
            </a>

            <div class="text-white-50 small fw-bold text-uppercase mt-3 mb-2 ms-2">Tools</div>
            <a href="/Admin/Simulator" class="nav-link text-warning fw-bold @(ViewContext.RouteData.Values["Action"]?.ToString() == "Simulator" ? "active" : "")">
                <i class="fas fa-gamepad me-2"></i> Simulator
            </a>
            <a href="/Admin/TestApi" class="nav-link text-success fw-bold @(ViewContext.RouteData.Values["Action"]?.ToString() == "TestApi" ? "active" : "")">
                <i class="fas fa-check-double me-2"></i> API Health
            </a>
        </nav>

        <div class="mt-auto text-center text-white-50 small pt-3 border-top border-secondary">
            <p class="mb-0">&copy; 2024 Minecraft Backend</p>
            <p>Powered by .NET 8</p>
        </div>
    </div>

    <div class="content animate__animated animate__fadeIn">
        <button class="btn btn-dark d-md-none mb-3 border-secondary shadow" onclick="document.querySelector('.sidebar').classList.toggle('active')">
            <i class="fas fa-bars"></i> Menu
        </button>

        @RenderBody()
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // --- AUDIO SYSTEM ---
        var bgm = document.getElementById("bgm");
        var sfx = document.getElementById("sfx"); 
        bgm.volume = 0.3; 
        sfx.volume = 0.8;

        function toggleMusic() { 
            if (bgm.paused) { 
                bgm.play().then(() => { 
                    document.getElementById('musicIcon').className = 'fas fa-pause me-2'; 
                    document.querySelector('button[onclick="toggleMusic()"]').innerHTML = '<i id="musicIcon" class="fas fa-pause me-2"></i>Music: ON';
                }).catch(e => { 
                    Swal.fire('Audio Blocked', 'Interact with the page first!', 'warning'); 
                });
            } else { 
                bgm.pause(); 
                document.getElementById('musicIcon').className = 'fas fa-play me-2'; 
                document.querySelector('button[onclick="toggleMusic()"]').innerHTML = '<i id="musicIcon" class="fas fa-play me-2"></i>Music: OFF';
            } 
        }

        // Global SFX for Buttons/Links
        document.addEventListener('click', function(e) { 
            if(e.target.tagName === 'BUTTON' || e.target.closest('button') || e.target.tagName === 'A' || e.target.closest('a')) { 
                sfx.currentTime = 0; 
                sfx.play().catch(() => {}); 
            } 
        });

        // --- TURBO LOADER LOGIC ---
        // Giả lập Loading khi chuyển trang
        window.addEventListener('beforeunload', () => {
            const loader = document.getElementById('page-loader');
            loader.style.width = '30%';
            loader.style.opacity = '1';
            let p = 30;
            const interval = setInterval(() => {
                p += Math.random() * 10;
                if(p > 90) p = 90;
                loader.style.width = p + '%';
            }, 200);
        });

        // Hàm helper cho AJAX loading
        window.startLoad = () => { 
            const l = document.getElementById('page-loader');
            l.style.width = '0%'; l.style.opacity = '1';
            setTimeout(() => l.style.width = '70%', 50); 
        };
        window.endLoad = () => { 
            const l = document.getElementById('page-loader'); 
            l.style.width = '100%';
            setTimeout(() => l.style.opacity = '0', 500); 
            setTimeout(() => l.style.width = '0%', 900);
        };

        // --- GLOBAL CONFIRM DELETE ---
        function confirmDel(url) { 
            Swal.fire({ 
                title: 'Are you sure?', 
                text: "This action cannot be undone!", 
                icon: 'warning', 
                showCancelButton: true, 
                confirmButtonColor: '#d33', 
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!', 
                background: '#1f2937', 
                color: '#fff' 
            }).then((result) => { 
                if (result.isConfirmed) { 
                    window.location.href = url; 
                } 
            }) 
        }
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>